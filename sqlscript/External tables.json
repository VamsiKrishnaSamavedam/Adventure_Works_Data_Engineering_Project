{
	"name": "External tables",
	"properties": {
		"content": {
			"query": "-- External tables to store the silver data to gold layer.\n\n-- Credentials(create a master key as well)\n\nCREATE MASTER KEY ENCRYPTION BY PASSWORD ='Lalita@111778';\n\nCREATE DATABASE SCOPED CREDENTIAL cred_vamsi\nWITH IDENTITY = 'Managed Identity';\n\n\n-- creating external data source silver to fetch the data\nCREATE EXTERNAL DATA SOURCE source_silver\nWITH (\n    LOCATION='https://azureprojectvamsi2.dfs.core.windows.net/silver/',\n    CREDENTIAL = cred_vamsi\n);\n \n\n-- creating external data source gold to push the fetched data for future reference\nCREATE EXTERNAL DATA SOURCE source_gold\nWITH (\n    LOCATION='https://azureprojectvamsi2.dfs.core.windows.net/gold/',\n    CREDENTIAL = cred_vamsi\n);\n\n\n-- creating external file format\nCREATE EXTERNAL FILE FORMAT file_parquet\nWITH (\n        FORMAT_TYPE= PARQUET,\n        DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'\n        );\n\n\n-- create the external tables for sales\nCREATE EXTERNAL TABLE gold.extsales\nWITH\n(\n    LOCATION='extsales',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n) AS SELECT * from gold.sales;\n\n-- create the external table for Territories\n\nCREATE EXTERNAL TABLE extTerritories\nWITH\n(\n    LOCATION='extTerritories',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n)\nAS SELECT * from  gold.territories;\n\n-- create the external table for calender\nCREATE EXTERNAL TABLE gold.extCalender\nWITH\n(\n    LOCATION='extCalender',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n)\nAS SELECT * from gold.calendar;\n\n-- create the external table for customers\nCREATE EXTERNAL TABLE gold.extcustomers\nWITH\n(\n    LOCATION='extCustomers',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n)\nAS SELECT * FROM gold.customers;\n\n\n-- create the external table for product_subcategories\nCREATE EXTERNAL TABLE gold.extproduct_subcategories\nWITH\n(\n    LOCATION='extproduct_subcategories',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n)\nAS SELECT * FROM gold.product_subcategories;\n\n-- create the external table for products\nCREATE EXTERNAL TABLE gold.extproducts\nWITH\n(\n    LOCATION='extproducts',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n)\nAS SELECT * FROM gold.products;\n\n-- create external tables for returns\nCREATE EXTERNAL TABLE gold.extreturns\nWITH\n(\n    LOCATION='extreturns',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n)\nAS SELECT * FROM gold.returns;\n\n\n\n/* Steps to create the external tables in synapse analytics\n1. Create the master key if it does not exists using this command\n    CREATE MASTER KEY ENCRYPTION BY PASSWORD ='password';\n2. create the credentials to give access to sysnapse to read the data lake from your storage account in azure\n    - CREATE DATABASE SCOPED CREDENTIAL cred_vamsi\n        WITH IDENTITY = 'Managed Identity';\n3. create the data source from where the file need to fetched and where the file need to be pushed.\n    \n    CREATE EXTERNAL DATA SOURCE source_silver (this is for silver layer fetching the data)\n    WITH (\n    LOCATION='https://azureprojectvamsi2.dfs.core.windows.net/silver/',\n    CREDENTIAL = cred_vamsi\n    );\n\n    CREATE EXTERNAL DATA SOURCE source_gold (gold layer to store the fetched data)\n    WITH (\n    LOCATION='https://azureprojectvamsi2.dfs.core.windows.net/gold/',\n    CREDENTIAL = cred_vamsi\n    );\n\n4. create the file format to which type of file \n    CREATE EXTERNAL FILE FORMAT file_parquet\n    WITH (\n        FORMAT_TYPE= PARQUET,\n        DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'\n        );\n\n5. create the external tables using external table as select\n    CREATE EXTERNAL TABLE gold.extreturns\n    WITH\n    (\n    LOCATION='extreturns',\n    DATA_SOURCE=source_gold,\n    FILE_FORMAT=file_parquet\n    )\n    AS SELECT * FROM gold.returns;\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "AW_database",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}